const TILE_ROTATE_TIME=2,LETTER_ROTATE_TIME=1,ALLOWED_KEYS=["Й","Ц","У","К","Е","Н","Г","Ш","Щ","З","Х","Ї","Ф","І","В","А","П","Р","О","Л","Д","Ж","Є","Я","Ч","С","М","И","Т","Ь","Б","Ю","BACKSPACE","ENTER"];let board=null,keyboard=null,entered_words=null,line_in_board=null,column_in_board=null,user_word=null,hidden_word=null,end_game=!1,lock_buttons=!1,game_loaded_from_url=!1,letter_rotate_deg={0:360,1:360,2:360,3:360,4:360,5:360,6:360},bible_mode=!1,bible_mode_difficulty_level=1;function toggle_bible_mode(e=!1){!1===bible_mode||!0===e?(!1===e&&(reset_game(),clear_save_game()),bible_mode=!0,hidden_word=make_a_word(),toast("Біблійний режим активований!"),document.querySelector("#run-bible-mode > img").src="images/open-book.svg"):(reset_game(),clear_save_game(),bible_mode=!1,hidden_word=make_a_word(),toast("Біблійний режим деактивований!"),document.querySelector("#run-bible-mode > img").src="images/closed-book.svg")}function random_integer(e,t){let o=e-.5+Math.random()*(t-e+1);return Math.round(o)}function run_title_animation(){let e=random_integer(0,6),t=document.getElementById(`title-letter-${e}`),o=letter_rotate_deg[String(e)];t.style.transition=`transform ${LETTER_ROTATE_TIME}s linear`,1===random_integer(0,1)?t.style.transform=`rotate(${o}deg)`:t.style.transform=`rotate3d(0, 1, 0, ${o}deg)`,letter_rotate_deg[String(e)]=360===o?0:360}function show_params(){document.getElementById("params-panel").style.display="block",document.getElementById("params-overlay").style.display="block",document.getElementById("open-params").style.display="none"}function hide_params(){document.getElementById("params-panel").style.display="none",document.getElementById("params-overlay").style.display="none",document.getElementById("open-params").style.display="block"}function set_value_variables_defoult(){line_in_board=0,column_in_board=0,user_word=[],board=[[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]],keyboard={"Й":0,"Ц":0,"У":0,"К":0,"Е":0,"Н":0,"Г":0,"Ш":0,"Щ":0,"З":0,"Х":0,"Ї":0,"Ф":0,"І":0,"В":0,"А":0,"П":0,"Р":0,"О":0,"Л":0,"Д":0,"Ж":0,"Є":0,"Я":0,"Ч":0,"С":0,"М":0,"И":0,"Т":0,"Ь":0,"Б":0,"Ю":0},entered_words=[],hidden_word=""}function button_clicked(e){if(!lock_buttons&&void 0!==e)return end_game?(end_game=!1,void reset_game()):void("ENTER"===e.toUpperCase()?word_entered():"BACKSPACE"===e.toUpperCase()?backspace_pressed():column_in_board<5&&(document.getElementById(`tile-${line_in_board}-${column_in_board}`).innerHTML=e,user_word.push(e.toLowerCase()),column_in_board++))}function backspace_pressed(){column_in_board>0&&(user_word=user_word.slice(0,-1),column_in_board--,document.getElementById(`tile-${line_in_board}-${column_in_board}`).innerHTML="")}function word_entered(){if(5===column_in_board)if(check_user_word(user_word)){entered_words.push(user_word),5===word_match_count()?(toast("Ви вгадали!"),clear_save_game(),end_game=!0,3===bible_mode_difficulty_level?bible_mode_difficulty_level=1:bible_mode_difficulty_level++):5!=line_in_board?(line_in_board++,column_in_board=0,user_word=[],save_game()):(toast(`Ви програли. Таємне слово: ${hidden_word.join("")}.`),clear_save_game(),end_game=!0,1!==bible_mode_difficulty_level&&(3===bible_mode_difficulty_level?bible_mode_difficulty_level=1:bible_mode_difficulty_level--))}else toast("Я не знаю цього слова.");else toast("Слово має бути з 5 літер.")}function toast(e){new Toast({title:!1,text:e,theme:"light",autohide:!0,interval:3e3})}function word_match_count(){let e,t,o=JSON.parse(JSON.stringify(hidden_word)),n=0;for(let e=0;e<hidden_word.length;e++)user_word[e]===hidden_word[e]&&(set_color_tile(line_in_board,e,"green"),set_color_button(user_word[e],"green"),hidden_word[e]="0",n++);for(let o=0;o<hidden_word.length;o++)(e=count_yellow_letter(user_word[o],hidden_word)).length>0?"green"!=get_color_tile(line_in_board,o)&&(hidden_word[e[0]]="0",set_color_tile(line_in_board,o,"yellow"),"green"!=get_color_button(user_word[o])&&set_color_button(user_word[o],"yellow")):"green"!=get_color_tile(line_in_board,o)&&(set_color_tile(line_in_board,o,"gray"),"green"!=(t=get_color_button(user_word[o]))&&"yellow"!=t&&set_color_button(user_word[o],"gray"));return sync_board(),sync_keyboard(),hidden_word=o,n}function count_yellow_letter(e,t){let o=[];e=e.toLowerCase();for(let n=0;n<t.length;n++)t[n]===e&&o.push(n);return o}function randomInteger(e,t){let o=e-.5+Math.random()*(t-e+1);return Math.round(o)}function reset_game(){!0!==game_loaded_from_url?(document.querySelectorAll(".button-keyboard").forEach(e=>{e.style.background="var(--white-button)",e.classList.add("white-button-keyboard")}),document.querySelectorAll(".tile").forEach(e=>{setTimeout(()=>{e.style.background="var(--white-tile)",e.innerHTML=""},1e3),rotate_tile(e)}),set_value_variables_defoult(),hidden_word=make_a_word()):window.location.href=window.location.href.replace(window.location.search,"")}function rotate_tile(e){lock_buttons=!0,e.style.transition=`transform ${TILE_ROTATE_TIME}s linear`,e.style.transform="rotate3d(1, 0, 0, 180deg)",setTimeout(()=>{e.style.transition="transform 0s linear",e.style.transform="rotate(360deg)",lock_buttons=!1},2e3)}function set_color_tile(e,t,o){switch(o){case"white":o=0;break;case"gray":o=1;break;case"yellow":o=2;break;case"green":o=3}board[e][t]=o}function get_color_tile(e,t){switch(color=board[e][t],color){case 0:color="white";break;case 1:color="gray";break;case 2:color="yellow";break;case 3:color="green"}return color}function sync_board(){let e=null;for(let t=0;t<board.length;t++)for(let o=0;o<board[t].length;o++)switch(e=document.getElementById(`tile-${t}-${o}`),board[t][o]){case 0:e.style.background="var(--white-tile)";break;case 1:e.style.background="var(--gray-tile)";break;case 2:e.style.background="var(--yellow-tile)";break;case 3:e.style.background="var(--green-tile)"}}function set_color_button(e,t){switch(t){case"white":t=0;break;case"gray":t=1;break;case"yellow":t=2;break;case"green":t=3}keyboard[e.toUpperCase()]=t}function get_color_button(e){let t=keyboard[e.toUpperCase()];switch(t){case 0:t="white";break;case 1:t="gray";break;case 2:t="yellow";break;case 3:t="green"}return t}function sync_keyboard(){let e=null;for(let t in keyboard)switch(e=document.querySelector(`.button-keyboard[data-letter=${t.toUpperCase()}]`),keyboard[t.toUpperCase()]){case 0:e.style.background="var(--white-button)";break;case 1:e.style.background="var(--gray-button)";break;case 2:e.style.background="var(--yellow-button)";break;case 3:e.style.background="var(--green-button)"}}function save_game(){if(!0===game_loaded_from_url)return;let e=localStorage;e.setItem("board",JSON.stringify(board)),e.setItem("keyboard",JSON.stringify(keyboard)),e.setItem("entered_words",JSON.stringify(entered_words)),e.setItem("hidden_word",JSON.stringify(hidden_word)),e.setItem("line_in_board",line_in_board),e.setItem("bible_mode",bible_mode),e.setItem("save","true")}function load_game(){try{let e=localStorage;if("true"===e.getItem("save")){board=JSON.parse(e.getItem("board")),keyboard=JSON.parse(e.getItem("keyboard")),entered_words=JSON.parse(e.getItem("entered_words")),hidden_word=JSON.parse(e.getItem("hidden_word")),line_in_board=Number(e.getItem("line_in_board")),!0===(bible_mode=JSON.parse(e.getItem("bible_mode")))&&toggle_bible_mode(!0);for(let e=0;e<entered_words.length;e++)for(let t=0;t<entered_words[e].length;t++)document.getElementById(`tile-${e}-${t}`).innerHTML=entered_words[e][t].toUpperCase();return sync_board(),sync_keyboard(),!0}return!1}catch(e){return clear_save_game(),!1}}function clear_save_game(){if(!0===game_loaded_from_url)return;localStorage.clear()}function get_url_from_game_state(e=null){let t=[];for(let e=0;e<entered_words.length;e++)t.push(entered_words[e].join(""));null!=e&&(t=t.slice(0,e));let o=[].concat([hidden_word.join("")],t).join(","),n=[];for(let e=0;e<o.length;e++)n.push(o[e].charCodeAt());return description_link=bible_mode?"Словограйчик - відгадай таємне слово.\n\nСпробуйте відгадати Біблійне слово.\n\n#словограйчик\n\n":"Словограйчик - відгадай таємне слово.\n\nСпробуйте відгадати мою загадку.\n\n#словограйчик\n\n",description_link+window.location.href.replace(window.location.search.replace("?puzzle=",""),"")+"?puzzle="+n.join(",")+"&bible_mode="+bible_mode}function set_game_state_from_url(){try{let e=window.location.search.replace("?puzzle=","").split("&bible_mode=");!0===(bible_mode=JSON.parse(e[1]))&&toggle_bible_mode(!0),e=e[0].split(","),console.log(e),console.log(bible_mode);let t="";for(let o=0;o<e.length;o++)t+=String.fromCharCode(Number(e[o]));t=t.split(","),hidden_word=t[0].split(""),(entered_words=t).shift();for(let e=0;e<entered_words.length;e++){user_word=entered_words[e].split(""),entered_words[e]=entered_words[e].split("");for(let e=0;e<user_word.length;e++)document.getElementById(`tile-${line_in_board}-${e}`).innerHTML=user_word[e].toUpperCase();word_match_count(),line_in_board++}user_word=[],sync_board(),sync_keyboard()}catch(e){toast("Сталася помилка при завантаженні загадки."),setTimeout(()=>{window.location.href=window.location.href.replace(window.location.search,"")},2e3)}}function toggleFullScreen(){document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement?(document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),document.querySelector("#fullscreen-button > img").src="images/fullscreen.svg"):(document.documentElement.requestFullscreen?document.documentElement.requestFullscreen():document.documentElement.msRequestFullscreen?document.documentElement.msRequestFullscreen():document.documentElement.mozRequestFullScreen?document.documentElement.mozRequestFullScreen():document.documentElement.webkitRequestFullscreen&&document.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT),document.querySelector("#fullscreen-button > img").src="images/fullscreen-exit.svg")}set_value_variables_defoult(),document.getElementById("open-params").onclick=(()=>{show_params()}),document.getElementById("params-overlay").onclick=(()=>{hide_params()}),document.getElementById("manual-button").onclick=(()=>{document.getElementById("manual").style.display="block",hide_params()}),document.getElementById("hide-manual-button").onclick=(()=>{document.getElementById("manual").style.display="none"}),document.getElementById("share-button").onclick=(()=>{document.getElementById("share-button").blur();let e=entered_words.length;0!=e?1===e&&!0===end_game?toast("Ви не можете скопіювати посилання на вашу загадку, тому що ви вгадали таємне слово з першого ходу."):1===e?(navigator.clipboard.writeText(get_url_from_game_state()),toast("Посилання на вашу загадку скопійовано в буфер обміну!")):(end_game&&e--,document.getElementById("number_strings").min="1",document.getElementById("number_strings").max=String(e),document.getElementById("number_strings").value=String(e),document.querySelector(".modal-open").checked=!0,document.getElementById("copy-button").focus(),lock_buttons=!0):toast("Щоб скопіювати посилання, почніть відгадувати таємне слово.")}),document.getElementById("copy-button").onclick=(()=>{let e=document.getElementById("number_strings").value,t=entered_words.length;end_game&&t--,""!=e&&Number(e)>=1&&Number(e)<=t&&(navigator.clipboard.writeText(get_url_from_game_state(e=e)),document.querySelector(".modal-open").checked=!1,lock_buttons=!1,toast("Посилання на вашу загадку скопійовано в буфер обміну!"))}),document.querySelectorAll(".button-keyboard").forEach(function(e){e.onclick=(()=>{e.blur(),button_clicked(e.dataset.letter)})}),document.addEventListener("keydown",e=>{lock_buttons||(end_game?(end_game=!1,reset_game()):(key=e.key.toUpperCase(),-1!=ALLOWED_KEYS.indexOf(key)&&button_clicked(key)))}),document.querySelectorAll(".tile").forEach(e=>{e.onclick=(()=>{const t={0:"перша",1:"друга",2:"третя",3:"четверта",4:"остання"};let o=e.id.replace("tile-","").split("-"),n=board[o[0]][o[1]],r=e.innerHTML;if(0!=n)switch(n){case 1:toast(`У таємному слові нема букви "${r.toUpperCase()}".`);break;case 2:toast(`Буква "${r.toUpperCase()}" є у таємному слові, але не ${t[o[1]]}.`);break;case 3:toast(`Буква "${r.toUpperCase()}" є у таємному слові, і стоїть на вірній позиції.`)}})}),document.getElementById("run-bible-mode").onclick=(()=>{document.getElementById("run-bible-mode").blur(),toggle_bible_mode()}),document.addEventListener("DOMContentLoaded",()=>{document.getElementById("fullscreen-button").onclick=toggleFullScreen,""!=window.location.search.replace("?puzzle=","")?(set_game_state_from_url(),game_loaded_from_url=!0):0==load_game()&&(hidden_word=make_a_word()),setInterval(run_title_animation,8e3)});